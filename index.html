<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadanly - Super App Ibadah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { primary: '#10B981', secondary: '#064E3B', accent: '#F59E0B' }
                }
            }
        }
    </script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-active { color: #10B981; border-top: 3px solid #10B981; }
        .quran-text { line-height: 2.5; font-family: 'Amiri', serif; }
        /* Animasi Transisi */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Custom Scroll */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #10B981; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-500 pb-20">

    <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-50 px-4 py-3 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="bg-primary p-2 rounded-lg text-white">
                <i class="fas fa-moon"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight">Ramadanly</h1>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="toggleNightMode()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                <i id="theme-icon" class="fas fa-sun text-accent"></i>
            </button>
            <div id="loc-display" class="text-xs font-semibold bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full flex items-center gap-1">
                <i class="fas fa-location-dot text-primary"></i> <span id="city-name">Jakarta</span>
            </div>
        </div>
    </header>

    <div class="w-full bg-gray-200 dark:bg-gray-700 h-1.5">
        <div id="ramadan-progress" class="bg-primary h-full transition-all duration-1000" style="width: 0%"></div>
    </div>

    <main class="container mx-auto p-4 max-w-2xl">
        
        <section id="tab-home" class="tab-content active fade-in space-y-6">
            <div class="bg-gradient-to-br from-secondary to-primary rounded-3xl p-6 text-white text-center shadow-lg relative overflow-hidden">
                <p id="label-next" class="text-xs uppercase tracking-widest opacity-80 mb-1">Menuju Berbuka</p>
                <h2 id="countdown-timer" class="text-5xl font-bold font-mono mb-2">00:00:00</h2>
                <div class="flex justify-center gap-4 text-xs opacity-90">
                    <span id="hijri-date">1 Ramadhan 1447 H</span>
                    <span>â€¢</span>
                    <span id="gregorian-date">Februari 2026</span>
                </div>
                <div class="mt-4 grid grid-cols-2 gap-2">
                    <div class="bg-white/10 rounded-xl p-2">
                        <p class="text-[10px] opacity-70">Imsak</p>
                        <p id="time-imsak" class="font-bold">--:--</p>
                    </div>
                    <div class="bg-white/10 rounded-xl p-2">
                        <p class="text-[10px] opacity-70">Syuruq (Sunrise)</p>
                        <p id="time-syuruq" class="font-bold">--:--</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700">
                    <h3 class="text-sm font-bold mb-3"><i class="fas fa-smile text-accent mr-2"></i>Mood Hari Ini</h3>
                    <div class="flex justify-around">
                        <button onclick="setMood('happy')" class="text-2xl hover:scale-125 transition">ğŸ˜‡</button>
                        <button onclick="setMood('tired')" class="text-2xl hover:scale-125 transition">ğŸ˜´</button>
                        <button onclick="setMood('hungry')" class="text-2xl hover:scale-125 transition">ğŸ˜‹</button>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 text-center">
                    <h3 class="text-sm font-bold mb-1"><i class="fas fa-tint text-blue-500 mr-2"></i>Water (2-4-2)</h3>
                    <div class="flex flex-wrap justify-center gap-1" id="water-container">
                        </div>
                    <p class="text-[10px] mt-2 text-gray-400">Target: 8 Gelas</p>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-3xl p-2 shadow-sm border border-gray-100 dark:border-gray-700" id="prayer-list">
                </div>
        </section>

        <section id="tab-quran" class="tab-content fade-in space-y-4">
            <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold">Al-Qur'an Digital</h2>
                    <div class="flex gap-2">
                        <button onclick="adjustFont(-2)" class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-lg text-sm">-A</button>
                        <button onclick="adjustFont(2)" class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-lg text-sm">+A</button>
                    </div>
                </div>
                <select id="quran-surah-list" onchange="loadSurahDetail(this.value)" class="w-full p-3 rounded-xl border dark:bg-gray-700 dark:border-gray-600 outline-none mb-4">
                    <option value="">Pilih Surah...</option>
                </select>
                <div id="last-read-box" class="text-xs bg-primary/10 text-primary p-3 rounded-xl mb-4 hidden">
                    <i class="fas fa-bookmark mr-2"></i> Terakhir baca: <span id="last-read-text"></span>
                </div>
            </div>

            <div id="quran-reader" class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm min-h-[400px]">
                <div id="quran-content" class="text-right space-y-8">
                    <p class="text-center text-gray-400">Pilih surah untuk mulai membaca...</p>
                </div>
            </div>
        </section>

        <section id="tab-ibadah" class="tab-content fade-in space-y-6">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm text-center border-4 border-primary/20">
                <h3 class="text-gray-400 text-sm uppercase mb-2">Tasbih Digital</h3>
                <div id="tasbih-count" class="text-6xl font-bold mb-6 text-primary">0</div>
                <button onclick="countTasbih()" class="w-32 h-32 rounded-full bg-primary text-white text-3xl shadow-xl active:scale-90 transition transform outline-none border-8 border-white dark:border-gray-700">
                    TAP
                </button>
                <div class="mt-4">
                    <button onclick="resetTasbih()" class="text-xs text-gray-400 underline">Reset Angka</button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm">
                <h3 class="font-bold mb-4">Checklist Harian</h3>
                <div id="checklist-grid" class="grid grid-cols-1 gap-2">
                    </div>
                <button onclick="shareProgress()" class="w-full mt-4 bg-green-500 text-white py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp"></i> Bagikan Progres
                </button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 text-center">
                    <h3 class="text-xs font-bold mb-4">Arah Kiblat</h3>
                    <div id="compass-box" class="relative w-24 h-24 mx-auto border-4 border-gray-100 rounded-full flex items-center justify-center">
                        <i id="compass-arrow" class="fas fa-location-arrow text-3xl text-primary transform -rotate-45"></i>
                    </div>
                    <p id="qibla-deg" class="text-[10px] mt-2 text-gray-400">Izinkan Sensor</p>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xs font-bold mb-2 text-center">Qadha Puasa</h3>
                    <input type="date" id="qadha-date" class="w-full text-[10px] dark:bg-gray-700 p-1 rounded">
                    <button onclick="addQadha()" class="w-full mt-2 bg-accent text-white text-[10px] py-1 rounded">Simpan Data</button>
                    <p id="qadha-list" class="mt-2 text-[9px] text-gray-500"></p>
                </div>
            </div>
        </section>

        <section id="tab-more" class="tab-content fade-in space-y-6">
            <div class="bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm">
                <h3 class="font-bold mb-3"><i class="fas fa-utensils text-orange-400 mr-2"></i>Rencana Makan</h3>
                <div class="space-y-3">
                    <input type="text" id="menu-sahur" placeholder="Menu Sahur..." class="w-full p-2 text-sm border rounded-lg dark:bg-gray-700">
                    <input type="text" id="menu-buka" placeholder="Menu Buka..." class="w-full p-2 text-sm border rounded-lg dark:bg-gray-700">
                    <button onclick="saveMenu()" class="text-xs text-primary font-bold">Simpan Menu</button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm">
                <h3 class="font-bold mb-3"><i class="fas fa-calculator text-blue-400 mr-2"></i>Kalkulator Zakat</h3>
                <input type="number" id="zakat-price" placeholder="Harga Beras/Kg (Rp)" class="w-full p-2 text-sm border rounded-lg dark:bg-gray-700 mb-2">
                <input type="number" id="zakat-member" placeholder="Jumlah Orang" class="w-full p-2 text-sm border rounded-lg dark:bg-gray-700">
                <p id="zakat-result" class="mt-2 font-bold text-primary"></p>
                <button onclick="calcZakat()" class="text-xs bg-gray-100 dark:bg-gray-700 px-3 py-1 mt-2 rounded">Hitung</button>
            </div>

            <div class="bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm">
                <h3 class="font-bold mb-3 text-secondary dark:text-primary">Koleksi Doa</h3>
                <div class="space-y-4">
                    <div class="border-b pb-2">
                        <p class="text-[10px] font-bold text-accent">DOA BUKA PUASA</p>
                        <p class="quran-text text-xl">Ø°ÙÙ‡ÙØ¨Ù Ø§Ù„Ø¸Ù‘ÙÙ…ÙØ£Ù ÙˆÙØ§Ø¨Ù’ØªÙÙ„Ù‘ÙØªÙ Ø§Ù„Ù’Ø¹ÙØ±ÙÙˆÙ‚Ù ÙˆÙØ«ÙØ¨ÙØªÙ Ø§Ù„Ø£ÙØ¬Ù’Ø±Ù Ø¥ÙÙ†Ù’ Ø´ÙØ§Ø¡Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù</p>
                        <p class="text-[10px] italic text-gray-500">"Dzahabaz zhama'u wabtallatil 'uruqu..."</p>
                    </div>
                </div>
            </div>

            <button onclick="toggleImsakiyahTable()" class="w-full bg-secondary text-white py-3 rounded-2xl">
                Lihat Jadwal 30 Hari
            </button>
            
            <div id="imsakiyah-table-container" class="hidden overflow-x-auto bg-white dark:bg-gray-800 p-2 rounded-xl text-[10px]">
                <table class="w-full text-left">
                    <thead><tr class="border-b"><th>Tgl</th><th>Imsak</th><th>Subuh</th><th>Maghrib</th></tr></thead>
                    <tbody id="imsakiyah-body"></tbody>
                </table>
            </div>

            <div class="bg-accent/10 p-4 rounded-xl border border-accent/20">
                <h4 class="text-xs font-bold text-accent mb-1 uppercase">Info Fidyah</h4>
                <p class="text-[10px] text-gray-600 dark:text-gray-400">Bagi yang tidak mampu berpuasa, wajib membayar fidyah berupa 1 mud (675 gram / 0.7 kg) makanan pokok untuk setiap hari yang ditinggalkan.</p>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 px-6 py-2 flex justify-between items-center z-50">
        <button onclick="switchTab('home')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" id="btn-home">
            <i class="fas fa-home"></i><span class="text-[10px]">Home</span>
        </button>
        <button onclick="switchTab('quran')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" id="btn-quran">
            <i class="fas fa-book-open"></i><span class="text-[10px]">Quran</span>
        </button>
        <button onclick="switchTab('ibadah')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" id="btn-ibadah">
            <i class="fas fa-pray"></i><span class="text-[10px]">Ibadah</span>
        </button>
        <button onclick="switchTab('more')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" id="btn-more">
            <i class="fas fa-ellipsis-h"></i><span class="text-[10px]">Lainnya</span>
        </button>
    </nav>

    <audio id="audio-adzan" src="https://www.islamcan.com/audio/adhan/makkah.mp3"></audio>

    <script>
        // --- DATA & STATE ---
        let prayerTimes = {};
        let currentQuranFontSize = 18;
        let tasbihCount = 0;
        let waterCount = 0;
        const checklists = ["Puasa", "Subuh", "Zuhur", "Ashar", "Maghrib", "Isya", "Tarawih", "Tadarus", "Sedekah"];

        // --- INITIALIZATION ---
        window.onload = () => {
            initApp();
            switchTab('home');
            initNightMode();
            renderWater();
            renderChecklist();
            loadQuranList();
            initLocation();
            updateJourneyProgress();
            loadSavedData();
        };

        // --- CORE FUNCTIONS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('nav-active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.getElementById(`btn-${tabId}`).classList.add('nav-active');
        }

        function initLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    fetchPrayerData(pos.coords.latitude, pos.coords.longitude);
                    calcQibla(pos.coords.latitude, pos.coords.longitude);
                }, () => fetchPrayerData(-6.2088, 106.8456)); // Default Jakarta
            }
        }

        async function fetchPrayerData(lat, lng) {
            const today = new Date();
            const res = await fetch(`https://api.aladhan.com/v1/timings/${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}?latitude=${lat}&longitude=${lng}&method=20`);
            const data = await res.json();
            prayerTimes = data.data.timings;
            renderPrayerList();
            startCountdown();
            document.getElementById('city-name').innerText = data.data.meta.timezone.split('/')[1];
            document.getElementById('hijri-date').innerText = `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year} H`;
            document.getElementById('gregorian-date').innerText = data.data.date.readable;
            
            // Build Monthly Table
            const resTable = await fetch(`https://api.aladhan.com/v1/calendar?latitude=${lat}&longitude=${lng}&method=20&month=${today.getMonth()+1}&year=${today.getFullYear()}`);
            const dataTable = await resTable.json();
            renderMonthlyTable(dataTable.data);
        }

        function renderPrayerList() {
            const list = document.getElementById('prayer-list');
            const keys = { 'Imsak': 'fa-moon', 'Fajr': 'fa-sun', 'Sunrise': 'fa-mountain-sun', 'Dhuhr': 'fa-sun', 'Asr': 'fa-cloud-sun', 'Maghrib': 'fa-sunset', 'Isha': 'fa-star' };
            
            list.innerHTML = Object.entries(keys).map(([key, icon]) => `
                <div class="flex justify-between items-center p-4 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-2xl transition">
                    <div class="flex items-center gap-3">
                        <i class="fas ${icon} text-primary w-5 text-center"></i>
                        <span class="text-sm font-semibold">${key === 'Fajr' ? 'Subuh' : key}</span>
                    </div>
                    <span class="font-mono font-bold">${prayerTimes[key]}</span>
                </div>
            `).join('');

            document.getElementById('time-imsak').innerText = prayerTimes.Imsak;
            document.getElementById('time-syuruq').innerText = prayerTimes.Sunrise;
        }

        function startCountdown() {
            setInterval(() => {
                const now = new Date();
                if (!prayerTimes.Maghrib) return;

                const maghrib = new Date();
                const [h, m] = prayerTimes.Maghrib.split(':');
                maghrib.setHours(h, m, 0);

                let diff = maghrib - now;
                
                // Jika sudah lewat maghrib, hitung ke imsak besok
                if (diff < 0) {
                    document.getElementById('label-next').innerText = "Menuju Imsak Besok";
                    const [ih, im] = prayerTimes.Imsak.split(':');
                    maghrib.setHours(ih, im, 0);
                    maghrib.setDate(maghrib.getDate() + 1);
                    diff = maghrib - now;
                } else {
                    document.getElementById('label-next').innerText = "Menuju Berbuka";
                }

                const hh = Math.floor(diff / 3600000);
                const mm = Math.floor((diff % 3600000) / 60000);
                const ss = Math.floor((diff % 60000) / 1000);

                document.getElementById('countdown-timer').innerText = 
                    `${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;
                
                // Auto Adzan
                if (hh === 0 && mm === 0 && ss === 0) document.getElementById('audio-adzan').play();
            }, 1000);
        }

        // --- QURAN FEATURES ---
        async function loadQuranList() {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            const select = document.getElementById('quran-surah-list');
            data.data.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.number;
                opt.text = `${s.number}. ${s.englishName} (${s.name})`;
                select.appendChild(opt);
            });
        }

        async function loadSurahDetail(num) {
            if(!num) return;
            const content = document.getElementById('quran-content');
            content.innerHTML = '<p class="text-center animate-pulse">Memuat ayat...</p>';
            
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}/ar.alafasy`);
            const data = await res.json();
            
            content.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-primary">${data.data.name}</h2>
                    <p class="text-xs text-gray-400">${data.data.englishNameTranslation}</p>
                    <audio controls class="mt-4 mx-auto h-8"><source src="${data.data.ayahs[0].audio}" type="audio/mpeg"></audio>
                </div>
                ${data.data.ayahs.map(a => `
                    <div class="border-b dark:border-gray-700 pb-4">
                        <p class="quran-text text-right" style="font-size: ${currentQuranFontSize}px">${a.text} <span class="text-primary text-sm font-sans">[${a.numberInSurah}]</span></p>
                    </div>
                `).join('')}
            `;
            
            // Save Progress
            localStorage.setItem('ramadanly_last_read', `${data.data.englishName} Ayah 1`);
            updateLastRead();
        }

        function adjustFont(val) {
            currentQuranFontSize += val;
            document.querySelectorAll('.quran-text').forEach(el => el.style.fontSize = currentQuranFontSize + 'px');
        }

        function updateLastRead() {
            const last = localStorage.getItem('ramadanly_last_read');
            if(last) {
                document.getElementById('last-read-box').classList.remove('hidden');
                document.getElementById('last-read-text').innerText = last;
            }
        }

        // --- UTILITY FEATURES ---
        function countTasbih() {
            tasbihCount++;
            document.getElementById('tasbih-count').innerText = tasbihCount;
            if (window.navigator.vibrate) window.navigator.vibrate(50);
            if (tasbihCount % 33 === 0) {
                if (window.navigator.vibrate) window.navigator.vibrate([100, 50, 100]);
            }
        }

        function resetTasbih() { tasbihCount = 0; document.getElementById('tasbih-count').innerText = 0; }

        function renderWater() {
            const cont = document.getElementById('water-container');
            cont.innerHTML = '';
            for(let i=1; i<=8; i++) {
                cont.innerHTML += `<i onclick="toggleWater(${i})" class="fas fa-tint text-xl cursor-pointer ${i <= waterCount ? 'text-blue-500' : 'text-gray-300'}"></i>`;
            }
        }
        function toggleWater(i) { waterCount = i; renderWater(); localStorage.setItem('ramadanly_water', i); }

        function renderChecklist() {
            const grid = document.getElementById('checklist-grid');
            const saved = JSON.parse(localStorage.getItem('ramadanly_check')) || {};
            grid.innerHTML = checklists.map(item => `
                <label class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-xl cursor-pointer">
                    <input type="checkbox" onchange="saveCheck('${item}', this.checked)" ${saved[item] ? 'checked' : ''} class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                    <span class="text-sm font-medium">${item}</span>
                </label>
            `).join('');
        }

        function saveCheck(item, val) {
            let saved = JSON.parse(localStorage.getItem('ramadanly_check')) || {};
            saved[item] = val;
            localStorage.setItem('ramadanly_check', JSON.stringify(saved));
            updateJourneyProgress();
        }

        function toggleNightMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('theme-icon').className = isDark ? 'fas fa-moon text-blue-400' : 'fas fa-sun text-accent';
        }

        function initNightMode() {
            const hour = new Date().getHours();
            if (hour >= 18 || hour <= 5) toggleNightMode();
        }

        function updateJourneyProgress() {
            // Simulasi: 15 Ramadhan
            const start = new Date('2026-02-18'); // Asumsi mulai Ramadhan
            const now = new Date();
            const day = Math.ceil((now - start) / (1000 * 60 * 60 * 24));
            const percent = Math.min(100, Math.max(0, (day / 30) * 100));
            document.getElementById('ramadan-progress').style.width = percent + '%';
        }

        function shareProgress() {
            const saved = JSON.parse(localStorage.getItem('ramadanly_check')) || {};
            const done = Object.values(saved).filter(v => v).length;
            const text = `Update Ibadah Ramadanly Rifqy Hari Ini:%0Aâœ… ${done}/${checklists.length} Ibadah Selesai%0AğŸ’§ ${waterCount}/8 Gelas Air%0AğŸ“– Tadarus: ${localStorage.getItem('ramadanly_last_read') || '-'}%0A%0ASemangat Puasanya!`;
            window.open(`https://wa.me/?text=${text}`);
        }

        function calcZakat() {
            const price = document.getElementById('zakat-price').value;
            const member = document.getElementById('zakat-member').value;
            if(price && member) {
                const total = price * 2.5 * member;
                document.getElementById('zakat-result').innerText = `Total: Rp ${total.toLocaleString()}`;
            }
        }

        function renderMonthlyTable(days) {
            const body = document.getElementById('imsakiyah-body');
            body.innerHTML = days.map(d => `
                <tr class="border-b dark:border-gray-700">
                    <td class="py-2">${d.date.readable.split(' ')[0]}</td>
                    <td>${d.timings.Imsak.split(' ')[0]}</td>
                    <td>${d.timings.Fajr.split(' ')[0]}</td>
                    <td class="font-bold text-primary">${d.timings.Maghrib.split(' ')[0]}</td>
                </tr>
            `).join('');
        }

        function toggleImsakiyahTable() { document.getElementById('imsakiyah-table-container').classList.toggle('hidden'); }

        function setMood(m) { localStorage.setItem('ramadanly_mood', m); alert("Mood disimpan! Semoga berkah."); }

        function loadSavedData() {
            waterCount = localStorage.getItem('ramadanly_water') || 0;
            renderWater();
            updateLastRead();
        }

        function calcQibla(lat, lng) {
            const phiK = 21.4225 * Math.PI / 180;
            const lambdaK = 39.8262 * Math.PI / 180;
            const phi = lat * Math.PI / 180;
            const lambda = lng * Math.PI / 180;
            const qibla = Math.atan2(Math.sin(lambdaK - lambda), Math.cos(phi) * Math.tan(phiK) - Math.sin(phi) * Math.cos(lambdaK - lambda));
            const deg = qibla * 180 / Math.PI;
            document.getElementById('qibla-deg').innerText = `Kiblat: ${Math.round(deg)}Â° N`;
            document.getElementById('compass-arrow').style.transform = `rotate(${deg}deg)`;
        }

        function saveMenu() {
            const s = document.getElementById('menu-sahur').value;
            const b = document.getElementById('menu-buka').value;
            localStorage.setItem('ramadanly_menu', JSON.stringify({s, b}));
            alert("Menu Berhasil Disimpan!");
        }

        function addQadha() {
            const date = document.getElementById('qadha-date').value;
            if(date) {
                let list = JSON.parse(localStorage.getItem('ramadanly_qadha')) || [];
                list.push(date);
                localStorage.setItem('ramadanly_qadha', JSON.stringify(list));
                document.getElementById('qadha-list').innerText = `Total Hutang: ${list.length} Hari`;
            }
        }

    </script>
</body>
</html>
